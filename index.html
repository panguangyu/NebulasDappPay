<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>扫码支付NAS - 享受数字货币支付时代</title>

    <!-- Bootstrap Core CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Main stylesheet -->
    <link href="assets/css/hallooou.css" rel="stylesheet">

    <!-- Color stylesheet -->
    <!-- <link href="assets/css/colors.css" rel="stylesheet"> -->
    <!-- <link href="assets/css/colors_2.css" rel="stylesheet"> -->
    <!-- <link href="assets/css/colors_3.css" rel="stylesheet"> -->
    <!-- <link href="assets/css/colors_4.css" rel="stylesheet"> -->


    <!-- Plugin stylesheets -->
    <link href="assets/css/plugins/owl.carousel.css" rel="stylesheet">
    <link href="assets/css/plugins/owl.theme.css" rel="stylesheet">
    <link href="assets/css/plugins/owl.transitions.css" rel="stylesheet">
    <link href="assets/css/plugins/animate.css" rel="stylesheet">
    <link href="assets/css/plugins/magnific-popup.css" rel="stylesheet">
    <link href="assets/css/plugins/jquery.mb.YTPlayer.min.css" rel="stylesheet">


    <!-- Custom Fonts -->
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Raleway:100,600' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <script>
        document.createElement('video');
      </script>
    <![endif]-->

</head>

<body id="home">
            <!-- Navigation -->
            <nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
                <div class="container">
                    <div class="navbar-header pull-left">
                        <a class="navbar-brand page-scroll" href="#page-top">
                            <!-- replace with your brand logo/text -->
                            <span class="brand-logo">扫码支付NAS</span>
                        </a>
                    </div>
                    <div class="main-nav pull-right">
                        <div class="button_container toggle">
                            <span class="top"></span>
                            <span class="middle"></span>
                            <span class="bottom"></span>
                        </div>
                    </div>
                </div><!-- /.container -->
            </nav>



            <!-- Intro Header -->
            <!-- Full Page Image Background Carousel Header -->
            <header id="intro-carousel" class="carousel slide">
                <!-- Optional Indicators -->
                <!-- <ol class="carousel-indicators">
                        <li data-target="#intro-carousel" data-slide-to="0" class="active"></li>
                        <li data-target="#intro-carousel" data-slide-to="1"></li>
                        <li data-target="#intro-carousel" data-slide-to="2"></li>
                    </ol> -->
                <!-- Wrapper for slides -->
                <div class="carousel-inner">
                    <div class="item active">
                        <!-- Set the first background image using inline CSS below. -->
                        <div class="fill" style="background-image:url('assets/images/cover-one.jpg');"></div>
                        <div class="carousel-caption">
                            <h1 class="wow animated slideInDown">在线支付NAS <span class="highlight">扫码并确认</span></h1>
                            <p class="intro-text wow animated slideInUp">享受数字货币支付时代，出门不用带现金，使用数字加密货币支付商品，安全又便捷</p>
                            <a href="#userArea" class="btn btn-default btn-lg" style='margin-right:20px;'>我是用户</a>
							
							<a href="#intro" class="btn btn-outlined btn-lg" style='margin-right:20px;'><i class="fa fa-paper-plane fa-fw"></i> 简介</a>
							
							
							<a href="#sellerArea" class="btn btn-default btn-lg">我是商家</a>
                        </div>
                        <div class="overlay-detail"></div>
                    </div><!-- /.item -->

                </div>
                <!-- Controls -->
                <a class="left carousel-control squared" href="#intro-carousel" data-slide="prev">
                    <i class="fa fa-angle-left fa-2x"></i>
                </a>
                <a class="right carousel-control squared" href="#intro-carousel" data-slide="next">
                    <i class="fa fa-angle-right fa-2x"></i>
                </a>
                <div class="mouse"></div>
            </header>



            <!-- About Section -->
            <section id="intro" class="about content-section alt-bg-light wow fadeInUp" data-wow-offset="10">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6">
                            <h2>NAS扫码支付</h2>
                            <h3 class="caption gray">未来愿景：未来将是数据加密货币支付的时代，除了支付宝、微信进行线下支付，加密货币更能做到！</h3>
                            <p>基于星云链技术的区块链保障支付双方的NAS货币的安全性</p>

                            <blockquote>
                                免费、安全，用户扫商家二维码填写支付的NAS进行线下支付，并在装有chrome钱包浏览器上完成钱包的转账即可。
                                <span>NAS扫码支付</span>
                            </blockquote>

                            <h3 class="gray light">NAS Pay is like the alipay with Nas coin !</h3>
							
							<h5>你必须安装 <a href="https://github.com/ChengOrangeJu/WebExtensionWallet" style='color:orange'>Chrome钱包插件</a> 才能正常使用本产品（已安装请忽略）</h5>

                        </div><!-- /.col-md-6 -->
                        
                        <div class="col-md-6">
                            <!-- Display image -->
                            <!-- <img src="assets/images/hallooou_template-iphone_sm.png" class="img-responsive"> -->
                            <!-- Optional video embed code -->
              
                        </div><!-- /.col-md-6 -->
                    </div><!-- /.row -->
                </div><!-- /.container -->
            </section><!-- /.section -->

			<section id="userArea" class="services content-section">
                <div class="container">
                    <div class="row text-center">
                        <div class="col-md-12">
                            <h2>我是用户</h2>
                            <h3 class="caption gray">使用微信、支付宝扫描商家二维码，扫描后页面中填写NAS金额，进行确认后即可获取交易号</h3>
                        </div><!-- /.col-md-12 -->

                        <div class="container">
                            <div class="row text-center">
                                <div class="col-md-12">
                                    <div class="row services-item text-center wow flipInX" data-wow-offset="10">
                                        <i class="fa fa-cogs fa-3x"></i>
                                        <h4>使用手机扫一扫，扫描商家二维码并支付</h4>
										
										<span id="tradediv">
                                        <p style='margin-top:20px;margin-bottom:10px;'>交易号：<input type='text' value='' style='color:black' id='tradeid'/></p>
	
										<span id='mycode'>
										
										
										</span>
										
										<a href="javascript:check()" class="btn btn-default btn-lg">马上支付</a>
										
										<a href="javascript:mycode()" class="btn btn-default btn-lg">demo 商家二维码</a>
										
										</span>
										
										</p>
                                    </div><!-- /.row -->
                                </div><!-- /.col-md-4 -->

                          
                            </div><!-- /.row -->
                        </div><!-- /.container -->

                    </div><!-- /.row -->
                </div><!-- /.container -->
            </section><!-- /.section -->

            <!-- Services Section -->
            <section id="sellerArea" class="services content-section">
                <div class="container">
                    <div class="row text-center">
                        <div class="col-md-12">
                            <h2>我是商家</h2>
                            <h3 class="caption gray">填写手机号、真实姓名、NAS钱包地址并生成支付二维码</h3>
                        </div><!-- /.col-md-12 -->

                        <div class="container">
                            <div class="row text-center">
                                <div class="col-md-12">
                                    <div class="row services-item text-center wow flipInX" data-wow-offset="10">
                                        <i class="fa fa-cogs fa-3x"></i>
                                        <h4 id='seller-tips'>以下选项均要填写完善</h4>
										<span style='margin-top:20px;' id='seller-info'>
                                        <p style='margin-top:20px;margin-bottom:10px;'>商家名称：<input type='text' value='' style='color:black' id='sellerName'/></p>
										
										<p style='margin-top:20px;margin-bottom:10px;'>钱包地址：<input type='text' value='' style='color:black' id='sellerWallet'/></p>
										
										<p style='margin-top:20px;margin-bottom:10px;'><a href="javascript:submit()" class="btn btn-default btn-lg">生成支付二维码</a></p>
										</span>
                                    </div><!-- /.row -->
                                </div><!-- /.col-md-4 -->

                          
                            </div><!-- /.row -->
                        </div><!-- /.container -->

                    </div><!-- /.row -->
                </div><!-- /.container -->
            </section><!-- /.section -->



         
            <!-- Footer -->
            <footer>
                <div class="container">
                    <div class="row text-center">
                        <div class="col-md-12 segment">
                            <a href="#" title="Hallooou - HTML5 Template">
                                <h2>
                                </h2>
                            </a>
                            <p class="white">We believe that the future will be the era of digital encryption currency payment.</p>
                        </div><!-- /.col-md-12 -->
                    </div><!-- /.row -->

                    <div class="row text-center">
                        <div class="col-md-12 social segment">
                            <h4>欢迎使用扫码支付NAS平台</h4>
                            <a href="#"><i class="fa fa-facebook fa-3x"></i></a>
                            <a href="#"><i class="fa fa-twitter fa-3x"></i></a>
                            <a href="#"><i class="fa fa-linkedin fa-3x"></i></a>
                        </div><!-- /.col-md-12 -->
                    </div><!-- /.row -->

                </div><!-- /.container -->

                <div class="copynote">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12 text-center">Copyright &copy; 2018 扫码支付NAS平台 由星云链区块链技术支持</div><!-- /.col-md-12 -->

                        </div><!-- /.row -->
                    </div><!-- /.container -->
                </div><!-- /.copynote -->

                <div class="nav pull-right scroll-top">
                    <a href="#home" title="Scroll to top"><i class="fa fa-angle-up"></i></a>
                </div>

            </footer><!-- /.footer -->



    <!-- jQuery -->
    <script src="assets/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="assets/js/bootstrap.min.js"></script>
	
	
	
    <script type="text/javascript" src="./dist/nebulas.js"></script>

    <script type="text/javascript" src="./dist/nebPay.js"></script>
	<script>
	"use strict";
    var dappContactAddress = "n1vG4cNrVj5rphz9NjG2QXw28nQodioyXVd";
    var nebulas = require("nebulas"), Account = Account, neb = new nebulas.Neb();
    neb.setRequest(new nebulas.HttpRequest("https://mainnet.nebulas.io"))


    var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
    var nebPay = new NebPay();
    var serialNumber
	
		function submit() {
			var sellerName = $("#sellerName").val();
			var sellerWallet = $("#sellerWallet").val();
			
		
			if (!sellerName || sellerName.length>20) {
				alert("必须填写商家名称，长度不得大于20个字符");
				return;
			}
			
			if (sellerWallet.length!=35) {
				alert("钱包地址不正确");
				return;
			}
			
			var from = dappContactAddress
			var value = "0";
			var nonce = "0"
			var gas_price = "1000000"
			var gas_limit = "2000000"
			var callFunction = "savePay"
			var callArgs = '["' + sellerName + '","' + sellerWallet + '"]';
			        var contract = {
				"function": callFunction,
				"args": callArgs
			}
			
			serialNumber = nebPay.call(from, value, callFunction, callArgs, {    //使用nebpay的call接口去调用合约,
				listener: function (resp) {
					
					intervalQuery = setInterval(function () {
								queryResultSeller(sellerWallet);
						}, 5000);

				}
			
			});
	
	
		
		}
		
						        // 定时器
        var intervalQuery2;
        // 根据交易流水号查询执行结果数据
        function queryResultSeller(sellerWallet) {
            nebPay.queryPayInfo(serialNumber)
                .then(function (resp) {
                    $("#result").val(resp);
                    var respObject = JSON.parse(resp)

                        clearInterval(intervalQuery2);
								
						$("#seller-info").html("<img src='http://qr.liantu.com/api.php?text=http://139.199.178.177/wallet-pay/pay.php?addr="+sellerWallet+"'/>");
										
						$("#seller-tips").html("点击右键可保存二维码，现用户可通过扫描此码为您支付NAS");
					
                    
                })
                .catch(function (err) {
                   console.log(err);
                })
        }
		
		function refresh() {
		
			var tradeid = new Date().getTime();
			
			$("#tradeid").html(tradeid);
		}
		
		function mycode() {
		
			var addr = "n1MsdXauB5jKKjMjeSXw3FcJbCR275LLaar";
		
			$("#mycode").html("<img src='http://qr.liantu.com/api.php?text=http://139.199.178.177/wallet-pay/pay.php?addr="+addr+"'/>");
		}
		
		function check(){
		
			var tradeid = $("#tradeid").val();
			
			if (!tradeid) {
			
				alert("请输入交易号");
				return;
			}
			
			$.ajax({
				type:"post",
				url:"./get.php", 
				data:{"tradeid":tradeid}, 
				success:function(json){
				
					
					var arr = JSON.parse(json);
					
					if (!arr || !arr[0]['sellerWallet']) {
						
						alert("该交易号不存在");
						
						return;
					}
					
						var from = dappContactAddress
						var value = arr[0]['nas'];
						var nonce = "0"
						var gas_price = "1000000"
						var gas_limit = "2000000"
						var callFunction = "payNas"
						// tradeId, sellerId, nas, buyerWallet
						var callArgs = '["' + arr[0]['nas']  + '","' + arr[0]['sellerWallet'] + '"]';
								var contract = {
							"function": callFunction,
							"args": callArgs
						}
						
						serialNumber = nebPay.call(from, value, callFunction, callArgs, {    //使用nebpay的call接口去调用合约,
						listener: function (resp) {
							console.log("thecallback is " + resp.result);
							
								intervalQuery = setInterval(function () {
									queryResultNas(arr[0]['nas']);
								}, 5000);
						}
						});
			
				
				}
			});
			

			
		}
		
				        // 定时器
        var intervalQuery;
        // 根据交易流水号查询执行结果数据
        function queryResultNas(nas) {
            nebPay.queryPayInfo(serialNumber)
                .then(function (resp) {
                    $("#result").val(resp);
                    var respObject = JSON.parse(resp)
     
                        alert('支付成功!');
                        clearInterval(intervalQuery);
						$("#tradediv").html(" <p style='margin-top:20px;margin-bottom:10px;'>已支付 "+nas+"NAS</p>");
					
                    
                })
                .catch(function (err) {
                   console.log(err);
                })
        }
	
	</script>

    <!-- Plugin JavaScript -->
    <script src="assets/js/plugins/wow.min.js"></script>
    <script src="assets/js/plugins/owl.carousel.min.js"></script>
    <script src="assets/js/plugins/jquery.parallax-1.1.3.js"></script>
    <script src="assets/js/plugins/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/plugins/jquery.mb.YTPlayer.min.js"></script>
    <script src="assets/js/plugins/jquery.countTo.js"></script>
    <script src="assets/js/plugins/jquery.inview.min.js"></script>
    <script src="assets/js/plugins/pace.min.js"></script>
    <script src="assets/js/plugins/jquery.easing.min.js"></script>
    <script src="assets/js/plugins/jquery.validate.min.js"></script>
    <script src="assets/js/plugins/additional-methods.min.js"></script> 

    <!-- Custom JavaScript -->
    <script src="assets/js/hallooou.js"></script>
	
	
</body>

</html>
